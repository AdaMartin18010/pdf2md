# 关机功能使用指南

## 功能概述

PDF转Markdown工具现在支持转换完成后自动关机功能，这对于批量处理大量PDF文件特别有用。

## 功能特点

### ✅ 主要功能

- **自动关机**: 转换完成后自动关机
- **延迟设置**: 可自定义关机延迟时间
- **用户确认**: 关机前会显示确认对话框
- **多平台支持**: 支持Windows、Linux、macOS
- **安全机制**: 提供取消关机功能

### 🔧 技术特性

- **跨平台兼容**: 自动检测操作系统并使用相应的关机命令
- **错误处理**: 完善的错误处理和日志记录
- **配置保存**: 关机设置会自动保存到配置文件

## 使用方法

### 1. 启用关机功能

1. 启动PDF转Markdown GUI
2. 切换到"设置"选项卡
3. 在"处理设置"部分找到"转换完成后操作"
4. 勾选"转换完成后自动关机"
5. 设置"关机延迟(秒)"（默认30秒）
6. 点击"保存设置"

### 2. 执行转换

1. 切换到"转换"选项卡
2. 设置输入和输出目录
3. 配置转换选项
4. 点击"开始转换"
5. 等待转换完成

### 3. 关机确认

转换完成后：

- 系统会显示关机确认对话框
- 选择"是"确认关机，选择"否"取消
- 确认后系统会在指定延迟时间后关机

## 平台支持

### Windows

- 关机命令: `shutdown /s /t {延迟秒数}`
- 取消命令: `shutdown /a`

### Linux

- 关机命令: `shutdown -h {延迟分钟数}`
- 取消命令: `shutdown -c`

### macOS

- 关机命令: `sudo shutdown -h +{延迟分钟数}`
- 取消命令: `sudo killall shutdown`

## 安全注意事项

### ⚠️ 重要提醒

1. **数据保存**: 确保在关机前保存所有重要数据
2. **程序关闭**: 关闭其他正在运行的程序
3. **网络连接**: 确保网络连接稳定（如果转换需要网络）
4. **电源管理**: 确保设备不会因为电源问题意外关机

### 🔒 安全机制

- **用户确认**: 每次关机前都会显示确认对话框
- **延迟保护**: 默认30秒延迟，给用户足够时间取消
- **日志记录**: 所有关机操作都会记录在日志中
- **错误处理**: 如果关机命令失败，会显示错误信息

## 配置选项

### 设置项说明

- **启用自动关机**: 开启/关闭关机功能
- **关机延迟**: 设置关机前的等待时间（秒）
- **默认值**: 30秒延迟

### 配置文件

关机设置保存在 `gui_config.json` 文件中：

```json
{
  "enable_shutdown": false,
  "shutdown_delay": "30"
}
```

## 故障排除

### 常见问题

#### 1. 关机命令执行失败

**原因**: 权限不足或命令不存在
**解决**:

- Windows: 以管理员身份运行程序
- Linux/macOS: 确保有sudo权限

#### 2. 关机被取消

**原因**: 用户取消或系统阻止
**解决**:

- 检查是否有其他程序阻止关机
- 确认用户权限
- 查看日志了解具体错误

#### 3. 设置不生效

**原因**: 配置文件损坏或权限问题
**解决**:

- 删除 `gui_config.json` 文件重新配置
- 检查文件权限
- 重启程序

### 日志查看

- 在GUI的"日志"选项卡中查看详细日志
- 日志包含所有关机相关的操作记录

## 测试功能

### 测试脚本

运行 `test_shutdown_feature.py` 来测试关机功能：

```bash
python test_shutdown_feature.py
```

### 测试内容

- 关机命令执行测试
- 取消关机功能测试
- 跨平台兼容性测试

## 最佳实践

### 💡 使用建议

1. **首次使用**: 建议先用测试脚本验证功能
2. **批量处理**: 适合大量PDF文件的批量转换
3. **夜间处理**: 可以在夜间无人值守时使用
4. **备份重要**: 确保重要数据已备份

### ⚡ 性能优化

- 设置合适的延迟时间（建议30-60秒）
- 在转换前关闭不必要的程序
- 确保系统有足够的磁盘空间

## 更新日志

### v1.0.0 (当前版本)

- ✅ 添加自动关机功能
- ✅ 支持多平台关机命令
- ✅ 用户确认机制
- ✅ 配置保存功能
- ✅ 错误处理和日志记录
- ✅ 测试工具

## 技术支持

如果遇到问题，请：

1. 查看日志文件了解详细错误信息
2. 运行测试脚本验证功能
3. 检查系统权限和配置
4. 联系技术支持

---

**注意**: 关机功能会实际关闭计算机，请谨慎使用并确保所有重要数据已保存。
